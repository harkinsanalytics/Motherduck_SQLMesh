2025-09-15 16:37:51,826 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'md:champions_league_data'} (connection.py:489)
2025-09-15 16:37:52,202 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:491)
2025-09-15 16:37:52,202 - ThreadPoolExecutor-0_0 - sqlmesh.core.console - WARNING - Model '"champions_league_data"."sqlmesh_example"."full_model"' was not found at /Users/AaronHarkins/Python/SQLMesh_Motherduck/tests/test_full_model.yaml (console.py:2260)
2025-09-15 16:37:52,203 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: md:champions_league_data (connection.py:479)
2025-09-15 16:37:52,203 - MainThread - sqlmesh.core.console - WARNING - The motherduck engine is not recommended for storing SQLMesh state in production deployments. Please see https://sqlmesh.readthedocs.io/en/stable/guides/configuration/#state-connection for a list of recommended engines and more information. (console.py:2260)
2025-09-15 16:37:54,987 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:125)
2025-09-15 16:37:54,990 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__staging' (evaluator.py:1360)
2025-09-15 16:37:54,990 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__staging" (base.py:2466)
2025-09-15 16:37:55,035 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__facts' (evaluator.py:1360)
2025-09-15 16:37:55,035 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__facts" (base.py:2466)
2025-09-15 16:37:55,077 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__intermediate' (evaluator.py:1360)
2025-09-15 16:37:55,078 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__intermediate" (base.py:2466)
2025-09-15 16:37:55,130 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-09-15 16:37:55,135 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema champions_league_data.sqlmesh__facts (evaluator.py:1463)
2025-09-15 16:37:55,136 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:37:55,137 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:37:55,141 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__283920282') (base.py:2466)
2025-09-15 16:37:55,168 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 4145969541> (evaluator.py:701)
2025-09-15 16:37:55,169 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 4145969541> (evaluator.py:910)
2025-09-15 16:37:55,190 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-31 00:00:00, 2025-09-07 00:00:00) into champions_league_data.sqlmesh__facts.facts__fct_ucl_league_standings__283920282' (evaluator.py:940)
2025-09-15 16:37:55,190 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ DESCRIBE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__283920282" (base.py:2466)
2025-09-15 16:37:55,269 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:37:55,270 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:37:55,271 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__283920282') (base.py:2466)
2025-09-15 16:37:55,275 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:37:55,276 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'champions_league_data' (base.py:2466)
2025-09-15 16:37:55,279 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0b74929922bf4a15b1fc79fc121cce9b */ CREATE OR REPLACE TABLE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__283920282" AS WITH "hometeam" AS (SELECT "match_id", "match_status", "matchday", "season_current_matchday", "hometeam_id" AS "team_id", "hometeam_tla" AS "team_tla", 'HOME_TEAM' AS "home_away", "score_full_time_hometeam" AS "score_fulltime", "score_halftime_hometeam" AS "score_halftime", "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__2315805281" AS "int_ucl_matches" WHERE 1 = 1 AND "stage" = 'LEAGUE_STAGE'), "awayteam" AS (SELECT "match_id", "match_status", "matchday", "season_current_matchday", "awayteam_id" AS "team_id", "awayteam_tla" AS "team_tla", 'AWAY_TEAM' AS "home_away", "score_full_time_awayteam" AS "score_fulltime", "score_halftime_awayteam" AS "score_halftime", "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__2315805281" AS "int_ucl_matches" WHERE 1 = 1 AND "stage" = 'LEAGUE_STAGE'), "unioned_data" AS (SELECT * FROM "hometeam" AS "hometeam" UNION ALL SELECT * FROM "awayteam" AS "awayteam"), "points" AS (SELECT "ud"."match_id", "ud"."matchday", "ud"."team_id", "ud"."team_tla", "t"."team_name", "ud"."home_away", "ud"."score_fulltime", "ud"."score_winner", SUM("ud"."score_halftime") OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "halftime_goals_scored", SUM("ud"."score_fulltime") OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_scored", CASE WHEN "ud"."score_winner" = "ud"."home_away" THEN 3 WHEN "ud"."score_winner" = 'DRAW' THEN 1 ELSE 0 END AS "points_earned" FROM "unioned_data" AS "ud" LEFT JOIN "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_teams__4282581205" AS "t" ON "ud"."team_id" = "t"."team_id" WHERE 1 = 1), "goals_conceded" AS (SELECT "p".*, SUM("p"."points_earned") OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_points_earned", "pp"."score_fulltime" AS "goals_conceded", SUM("pp"."score_fulltime") OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_conceded" FROM "points" AS "p" JOIN "points" AS "pp" ON "p"."match_id" = "pp"."match_id" AND "p"."team_id" <> "pp"."team_id") SELECT "matchday" AS "matchday", "team_tla" AS "team_tla", "team_name" AS "team_name", "total_points_earned" AS "total_points_earned", "total_goals_scored" AS "total_goals_scored", "total_goals_conceded" AS "total_goals_conceded", ("total_goals_scored" - "total_goals_conceded") AS "goal_differential" FROM "goals_conceded" AS "goals_conceded" WHERE 1 = 1 ORDER BY 1, 4 DESC, 7 DESC, 5 DESC, 3 (base.py:2466)
2025-09-15 16:37:55,359 - MainThread - sqlmesh.core.scheduler - INFO - Execution failed for node EvaluateNode(snapshot_name='"champions_league_data"."facts"."fct_ucl_league_standings"', interval=(1756598400000, 1757203200000), batch_index=0) (scheduler.py:597)
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 234, in sequential_apply_to_dag
    fn(node)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/scheduler.py", line 533, in run_node
    audit_results = self.evaluate(
                    ^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/scheduler.py", line 229, in evaluate
    wap_id = self.snapshot_evaluator.evaluate(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 182, in evaluate
    result = self._evaluate_snapshot(
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 797, in _evaluate_snapshot
    self._render_and_insert_snapshot(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 990, in _render_and_insert_snapshot
    apply(query_or_df, index)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 946, in apply
    evaluation_strategy.insert(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 2116, in insert
    self._replace_query_for_model(model, table_name, query_or_df, render_kwargs, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 1864, in _replace_query_for_model
    self.adapter.replace_query(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/shared.py", line 312, in internal_wrapper
    return func(*list_args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 512, in replace_query
    return self._create_table_from_source_queries(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 917, in _create_table_from_source_queries
    self._create_table(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/duckdb.py", line 188, in _create_table
    super()._create_table(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 960, in _create_table
    self.execute(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 2443, in execute
    self._execute(sql, track_rows_processed, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 2475, in _execute
    self.cursor.execute(sql, **kwargs)
duckdb.duckdb.BinderException: Binder Error: Referenced column "score_full_time_hometeam" not found in FROM clause!
Candidate bindings: "score_fulltime_home", "score_halftime_home", "score_fulltime_away", "score_halftime_away", "score_duration"

LINE 1: ...", "hometeam_tla" AS "team_tla", 'HOME_TEAM' AS "home_away", "score_full_time_hometeam" AS "score_fulltime", "score_half...
                                                                        ^

The above exception was the direct cause of the following exception:

sqlmesh.utils.concurrency.NodeExecutionFailedError: Execution failed for node EvaluateNode(snapshot_name='"champions_league_data"."facts"."fct_ucl_league_standings"', interval=(1756598400000, 1757203200000), batch_index=0)
2025-09-15 16:37:55,368 - MainThread - sqlmesh.core.context - INFO - Plan application failed. (context.py:1735)
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/context.py", line 1727, in apply
    self._apply(plan, circuit_breaker)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/context.py", line 2519, in _apply
    self._scheduler.create_plan_evaluator(self).evaluate(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 107, in evaluate
    self._evaluate_stages(plan_stages, plan)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 127, in _evaluate_stages
    handler(stage, plan)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 265, in visit_backfill_stage
    raise PlanError("Plan application failed.")
sqlmesh.utils.errors.PlanError: Plan application failed.
2025-09-15 16:37:55,369 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
