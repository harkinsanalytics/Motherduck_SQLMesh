2025-09-15 16:41:53,017 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'md:champions_league_data'} (connection.py:489)
2025-09-15 16:41:53,406 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:491)
2025-09-15 16:41:53,407 - ThreadPoolExecutor-0_0 - sqlmesh.core.console - WARNING - Model '"champions_league_data"."sqlmesh_example"."full_model"' was not found at /Users/AaronHarkins/Python/SQLMesh_Motherduck/tests/test_full_model.yaml (console.py:2260)
2025-09-15 16:41:53,408 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: md:champions_league_data (connection.py:479)
2025-09-15 16:41:53,408 - MainThread - sqlmesh.core.console - WARNING - The motherduck engine is not recommended for storing SQLMesh state in production deployments. Please see https://sqlmesh.readthedocs.io/en/stable/guides/configuration/#state-connection for a list of recommended engines and more information. (console.py:2260)
2025-09-15 16:41:55,936 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-09-15 16:41:56,322 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:125)
2025-09-15 16:41:56,323 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__intermediate' (evaluator.py:1360)
2025-09-15 16:41:56,324 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__intermediate" (base.py:2466)
2025-09-15 16:41:56,365 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__facts' (evaluator.py:1360)
2025-09-15 16:41:56,365 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__facts" (base.py:2466)
2025-09-15 16:41:56,418 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__staging' (evaluator.py:1360)
2025-09-15 16:41:56,419 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__staging" (base.py:2466)
2025-09-15 16:41:56,460 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-09-15 16:41:56,463 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema champions_league_data.sqlmesh__facts (evaluator.py:1463)
2025-09-15 16:41:56,463 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:56,464 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:56,467 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__1112603809') (base.py:2466)
2025-09-15 16:41:56,485 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 3848209475> (evaluator.py:701)
2025-09-15 16:41:56,485 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 3848209475> (evaluator.py:910)
2025-09-15 16:41:56,519 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-08-31 00:00:00, 2025-09-07 00:00:00) into champions_league_data.sqlmesh__facts.facts__fct_ucl_league_standings__1112603809' (evaluator.py:940)
2025-09-15 16:41:56,519 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ DESCRIBE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__1112603809" (base.py:2466)
2025-09-15 16:41:56,598 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:56,599 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:56,601 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__1112603809') (base.py:2466)
2025-09-15 16:41:56,607 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:56,608 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'champions_league_data' (base.py:2466)
2025-09-15 16:41:56,612 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE OR REPLACE TABLE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__1112603809" AS WITH "hometeam" AS (SELECT "int_ucl_matches"."match_id" AS "match_id", "int_ucl_matches"."match_status" AS "match_status", "int_ucl_matches"."matchday" AS "matchday", "int_ucl_matches"."season_current_matchday" AS "season_current_matchday", "int_ucl_matches"."hometeam_id" AS "team_id", "int_ucl_matches"."hometeam_tla" AS "team_tla", 'HOME_TEAM' AS "home_away", "int_ucl_matches"."score_fulltime_home" AS "score_fulltime", "int_ucl_matches"."score_halftime_home" AS "score_halftime", "int_ucl_matches"."score_winner" AS "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__2315805281" AS "int_ucl_matches" WHERE "int_ucl_matches"."stage" = 'LEAGUE_STAGE'), "awayteam" AS (SELECT "int_ucl_matches"."match_id" AS "match_id", "int_ucl_matches"."match_status" AS "match_status", "int_ucl_matches"."matchday" AS "matchday", "int_ucl_matches"."season_current_matchday" AS "season_current_matchday", "int_ucl_matches"."awayteam_id" AS "team_id", "int_ucl_matches"."awayteam_tla" AS "team_tla", 'AWAY_TEAM' AS "home_away", "int_ucl_matches"."score_fulltime_away" AS "score_fulltime", "int_ucl_matches"."score_halftime_away" AS "score_halftime", "int_ucl_matches"."score_winner" AS "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__2315805281" AS "int_ucl_matches" WHERE "int_ucl_matches"."stage" = 'LEAGUE_STAGE'), "unioned_data" AS (SELECT "hometeam"."match_id" AS "match_id", "hometeam"."match_status" AS "match_status", "hometeam"."matchday" AS "matchday", "hometeam"."season_current_matchday" AS "season_current_matchday", "hometeam"."team_id" AS "team_id", "hometeam"."team_tla" AS "team_tla", "hometeam"."home_away" AS "home_away", "hometeam"."score_fulltime" AS "score_fulltime", "hometeam"."score_halftime" AS "score_halftime", "hometeam"."score_winner" AS "score_winner" FROM "hometeam" AS "hometeam" UNION ALL SELECT "awayteam"."match_id" AS "match_id", "awayteam"."match_status" AS "match_status", "awayteam"."matchday" AS "matchday", "awayteam"."season_current_matchday" AS "season_current_matchday", "awayteam"."team_id" AS "team_id", "awayteam"."team_tla" AS "team_tla", "awayteam"."home_away" AS "home_away", "awayteam"."score_fulltime" AS "score_fulltime", "awayteam"."score_halftime" AS "score_halftime", "awayteam"."score_winner" AS "score_winner" FROM "awayteam" AS "awayteam"), "points" AS (SELECT "ud"."match_id" AS "match_id", "ud"."matchday" AS "matchday", "ud"."team_id" AS "team_id", "ud"."team_tla" AS "team_tla", "t"."team_name" AS "team_name", "ud"."home_away" AS "home_away", "ud"."score_fulltime" AS "score_fulltime", "ud"."score_winner" AS "score_winner", SUM(CAST("ud"."score_halftime" AS INT)) OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "halftime_goals_scored", SUM(CAST("ud"."score_fulltime" AS INT)) OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_scored", CASE WHEN "ud"."home_away" = "ud"."score_winner" THEN 3 WHEN "ud"."score_winner" = 'DRAW' THEN 1 ELSE 0 END AS "points_earned" FROM "unioned_data" AS "ud" LEFT JOIN "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_teams__4282581205" AS "t" ON "t"."team_id" = "ud"."team_id"), "goals_conceded" AS (SELECT "p"."match_id" AS "match_id", "p"."matchday" AS "matchday", "p"."team_id" AS "team_id", "p"."team_tla" AS "team_tla", "p"."team_name" AS "team_name", "p"."home_away" AS "home_away", "p"."score_fulltime" AS "score_fulltime", "p"."score_winner" AS "score_winner", "p"."halftime_goals_scored" AS "halftime_goals_scored", "p"."total_goals_scored" AS "total_goals_scored", "p"."points_earned" AS "points_earned", SUM(CAST("p"."points_earned" AS INT)) OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_points_earned", "pp"."score_fulltime" AS "goals_conceded", SUM(CAST("pp"."score_fulltime" AS INT)) OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_conceded" FROM "points" AS "p" JOIN "points" AS "pp" ON "p"."match_id" = "pp"."match_id" AND "p"."team_id" <> "pp"."team_id") SELECT "goals_conceded"."matchday" AS "matchday", "goals_conceded"."team_tla" AS "team_tla", "goals_conceded"."team_name" AS "team_name", "goals_conceded"."total_points_earned" AS "total_points_earned", "goals_conceded"."total_goals_scored" AS "total_goals_scored", "goals_conceded"."total_goals_conceded" AS "total_goals_conceded", "goals_conceded"."total_goals_scored" - "goals_conceded"."total_goals_conceded" AS "goal_differential" FROM "goals_conceded" AS "goals_conceded" ORDER BY "matchday", "total_points_earned" DESC, "goal_differential" DESC, "total_goals_scored" DESC, "team_name" (base.py:2466)
2025-09-15 16:41:56,758 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-08-31 00:00:00, 2025-09-07 00:00:00) for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 3848209475> (facade.py:622)
2025-09-15 16:41:56,758 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 3848209475> (interval.py:214)
2025-09-15 16:41:57,040 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-09-15 16:41:57,040 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:165)
2025-09-15 16:41:57,719 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:125)
2025-09-15 16:41:57,868 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-09-15 16:41:57,872 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.facts' (evaluator.py:1360)
2025-09-15 16:41:57,873 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."facts" (base.py:2466)
2025-09-15 16:41:57,916 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'champions_league_data.facts.fct_ucl_league_standings' to point at table 'champions_league_data.sqlmesh__facts.facts__fct_ucl_league_standings__1112603809' (evaluator.py:1732)
2025-09-15 16:41:57,917 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:57,918 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-15 16:41:57,919 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'facts') AND table_name IN ('fct_ucl_league_standings') (base.py:2466)
2025-09-15 16:41:57,925 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 5abfc159b12644e6bcc7e46485879653 */ CREATE OR REPLACE VIEW "champions_league_data"."facts"."fct_ucl_league_standings" AS SELECT * FROM "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__1112603809" (base.py:2466)
2025-09-15 16:41:58,037 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:125)
2025-09-15 16:41:58,038 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:141)
2025-09-15 16:41:58,131 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
