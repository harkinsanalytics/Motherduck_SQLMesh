2025-09-16 18:09:08,242 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'md:champions_league_data'} (connection.py:489)
2025-09-16 18:09:08,661 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:491)
2025-09-16 18:09:08,662 - ThreadPoolExecutor-0_0 - sqlmesh.core.console - WARNING - Model '"champions_league_data"."sqlmesh_example"."full_model"' was not found at /Users/AaronHarkins/Python/SQLMesh_Motherduck/tests/test_full_model.yaml (console.py:2260)
2025-09-16 18:09:08,664 - MainThread - sqlmesh.core.config.connection - INFO - Using existing DuckDB adapter due to overlapping data file: md:champions_league_data (connection.py:479)
2025-09-16 18:09:08,664 - MainThread - sqlmesh.core.console - WARNING - The motherduck engine is not recommended for storing SQLMesh state in production deployments. Please see https://sqlmesh.readthedocs.io/en/stable/guides/configuration/#state-connection for a list of recommended engines and more information. (console.py:2260)
2025-09-16 18:09:18,358 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage CreateSnapshotRecordsStage (evaluator.py:125)
2025-09-16 18:09:18,884 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:125)
2025-09-16 18:09:18,887 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__staging' (evaluator.py:1360)
2025-09-16 18:09:18,887 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__staging" (base.py:2466)
2025-09-16 18:09:18,954 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__intermediate' (evaluator.py:1360)
2025-09-16 18:09:18,955 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__intermediate" (base.py:2466)
2025-09-16 18:09:19,024 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__facts' (evaluator.py:1360)
2025-09-16 18:09:19,024 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__facts" (base.py:2466)
2025-09-16 18:09:19,068 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.sqlmesh__snapshots' (evaluator.py:1360)
2025-09-16 18:09:19,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."sqlmesh__snapshots" (base.py:2466)
2025-09-16 18:09:19,117 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:125)
2025-09-16 18:09:19,121 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema champions_league_data.sqlmesh__intermediate (evaluator.py:1463)
2025-09-16 18:09:19,122 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,124 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,126 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__intermediate') AND table_name IN ('intermediate__int_ucl_matches__3904863268') (base.py:2466)
2025-09-16 18:09:19,149 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema champions_league_data.sqlmesh__facts (evaluator.py:1463)
2025-09-16 18:09:19,149 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,149 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,151 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__244289869') (base.py:2466)
2025-09-16 18:09:19,155 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"champions_league_data"."intermediate"."int_ucl_matches": 1559678094> (evaluator.py:701)
2025-09-16 18:09:19,155 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"champions_league_data"."intermediate"."int_ucl_matches": 1559678094> (evaluator.py:910)
2025-09-16 18:09:19,188 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-09-05 00:00:00, 2025-09-11 00:00:00) into champions_league_data.sqlmesh__intermediate.intermediate__int_ucl_matches__3904863268' (evaluator.py:940)
2025-09-16 18:09:19,188 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ DESCRIBE "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__3904863268" (base.py:2466)
2025-09-16 18:09:19,271 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,271 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,272 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__intermediate') AND table_name IN ('intermediate__int_ucl_matches__3904863268') (base.py:2466)
2025-09-16 18:09:19,275 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:19,276 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'champions_league_data' (base.py:2466)
2025-09-16 18:09:19,280 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE OR REPLACE TABLE "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__3904863268" AS WITH "t1" AS (SELECT "m"."competition_id" AS "competition_id", "m"."competition_name" AS "competition_name", "m"."competition_code" AS "competition_code", "m"."season_id" AS "season_id", "m"."season_start_date" AS "season_start_date", "m"."season_end_date" AS "season_end_date", "m"."season_current_matchday" AS "season_current_matchday", "m"."match_id" AS "match_id", "m"."match_datetime_est" AS "match_datetime_est", CAST("m"."match_datetime_est" AS DATE) AS "match_date", "m"."match_status" AS "match_status", "m"."matchday" AS "matchday", "m"."stage" AS "stage", "m"."group" AS "group", "m"."lastupdated" AS "lastupdated", "m"."hometeam_id" AS "hometeam_id", "m"."hometeam_name" AS "hometeam_name", "m"."hometeam_shortname" AS "hometeam_shortname", "m"."hometeam_tla" AS "hometeam_tla", "m"."awayteam_id" AS "awayteam_id", "m"."awayteam_name" AS "awayteam_name", "m"."awayteam_shortname" AS "awayteam_shortname", "m"."awayteam_tla" AS "awayteam_tla", "m"."score_winner" AS "score_winner", "m"."score_duration" AS "score_duration", "m"."score_fulltime_home" AS "score_fulltime_home", "m"."score_fulltime_away" AS "score_fulltime_away", "m"."score_halftime_home" AS "score_halftime_home", "m"."score_halftime_away" AS "score_halftime_away", "m"."referees" AS "referees", "l"."latitude" AS "hometeam_latitude", "l"."longitude" AS "hometeam_longitude", "ll"."latitude" AS "awayteam_latitude", "ll"."longitude" AS "awayteam_longitude", "t"."european_rank" AS "hometeam_european_rank", "tt"."european_rank" AS "awayteam_european_rank", "t"."ucl_rank" AS "hometeam_ucl_rank", "tt"."ucl_rank" AS "awayteam_ucl_rank" FROM "champions_league_data"."sqlmesh__staging"."staging__stg_ucl_matches__1679965645" AS "m" LEFT JOIN "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_teams__2148090398" AS "t" ON "m"."hometeam_id" = "t"."team_id" LEFT JOIN "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_teams__2148090398" AS "tt" ON "m"."awayteam_id" = "tt"."team_id" LEFT JOIN "champions_league_data"."sqlmesh__staging"."staging__stg_ucl_latlong__3331770713" AS "l" ON "l"."team_id" = "m"."hometeam_id" LEFT JOIN "champions_league_data"."sqlmesh__staging"."staging__stg_ucl_latlong__3331770713" AS "ll" ON "ll"."team_id" = "m"."awayteam_id"), "travel_distance" AS (SELECT "t1"."competition_id" AS "competition_id", "t1"."competition_name" AS "competition_name", "t1"."competition_code" AS "competition_code", "t1"."season_id" AS "season_id", "t1"."season_start_date" AS "season_start_date", "t1"."season_end_date" AS "season_end_date", "t1"."season_current_matchday" AS "season_current_matchday", "t1"."match_id" AS "match_id", "t1"."match_datetime_est" AS "match_datetime_est", "t1"."match_date" AS "match_date", "t1"."match_status" AS "match_status", "t1"."matchday" AS "matchday", "t1"."stage" AS "stage", "t1"."group" AS "group", "t1"."lastupdated" AS "lastupdated", "t1"."hometeam_id" AS "hometeam_id", "t1"."hometeam_name" AS "hometeam_name", "t1"."hometeam_shortname" AS "hometeam_shortname", "t1"."hometeam_tla" AS "hometeam_tla", "t1"."awayteam_id" AS "awayteam_id", "t1"."awayteam_name" AS "awayteam_name", "t1"."awayteam_shortname" AS "awayteam_shortname", "t1"."awayteam_tla" AS "awayteam_tla", "t1"."score_winner" AS "score_winner", "t1"."score_duration" AS "score_duration", "t1"."score_fulltime_home" AS "score_fulltime_home", "t1"."score_fulltime_away" AS "score_fulltime_away", "t1"."score_halftime_home" AS "score_halftime_home", "t1"."score_halftime_away" AS "score_halftime_away", "t1"."referees" AS "referees", "t1"."hometeam_latitude" AS "hometeam_latitude", "t1"."hometeam_longitude" AS "hometeam_longitude", "t1"."awayteam_latitude" AS "awayteam_latitude", "t1"."awayteam_longitude" AS "awayteam_longitude", "t1"."hometeam_european_rank" AS "hometeam_european_rank", "t1"."awayteam_european_rank" AS "awayteam_european_rank", "t1"."hometeam_ucl_rank" AS "hometeam_ucl_rank", "t1"."awayteam_ucl_rank" AS "awayteam_ucl_rank", ROUND(7918 * ASIN(SQRT(POWER(SIN(RADIANS("t1"."awayteam_latitude" - "t1"."hometeam_latitude") / 2), 2) + COS(RADIANS("t1"."hometeam_latitude")) * COS(RADIANS("t1"."awayteam_latitude")) * POWER(SIN(RADIANS("t1"."awayteam_longitude" - "t1"."hometeam_longitude") / 2), 2))), 2) AS "distance_in_miles", MAX("t1"."match_date") OVER (PARTITION BY "t1"."matchday" ORDER BY "t1"."match_date" DESC) AS "last_match" FROM "t1" AS "t1") SELECT "td"."competition_id" AS "competition_id", "td"."competition_name" AS "competition_name", "td"."competition_code" AS "competition_code", "td"."season_id" AS "season_id", "td"."season_start_date" AS "season_start_date", "td"."season_end_date" AS "season_end_date", "td"."season_current_matchday" AS "season_current_matchday", "td"."match_id" AS "match_id", "td"."match_datetime_est" AS "match_datetime_est", "td"."match_date" AS "match_date", "td"."match_status" AS "match_status", "td"."matchday" AS "matchday", "td"."stage" AS "stage", "td"."group" AS "group", "td"."lastupdated" AS "lastupdated", "td"."hometeam_id" AS "hometeam_id", "td"."hometeam_name" AS "hometeam_name", "td"."hometeam_shortname" AS "hometeam_shortname", "td"."hometeam_tla" AS "hometeam_tla", "td"."awayteam_id" AS "awayteam_id", "td"."awayteam_name" AS "awayteam_name", "td"."awayteam_shortname" AS "awayteam_shortname", "td"."awayteam_tla" AS "awayteam_tla", "td"."score_winner" AS "score_winner", "td"."score_duration" AS "score_duration", "td"."score_fulltime_home" AS "score_fulltime_home", "td"."score_fulltime_away" AS "score_fulltime_away", "td"."score_halftime_home" AS "score_halftime_home", "td"."score_halftime_away" AS "score_halftime_away", "td"."referees" AS "referees", "td"."hometeam_latitude" AS "hometeam_latitude", "td"."hometeam_longitude" AS "hometeam_longitude", "td"."awayteam_latitude" AS "awayteam_latitude", "td"."awayteam_longitude" AS "awayteam_longitude", "td"."hometeam_european_rank" AS "hometeam_european_rank", "td"."awayteam_european_rank" AS "awayteam_european_rank", "td"."hometeam_ucl_rank" AS "hometeam_ucl_rank", "td"."awayteam_ucl_rank" AS "awayteam_ucl_rank", "td"."distance_in_miles" AS "distance_in_miles", "td"."last_match" AS "week_ending_date", LEAD("td"."last_match") OVER (ORDER BY "td"."matchday" DESC) + INTERVAL '1' DAY AS "week_starting_date" FROM "travel_distance" AS "td" (base.py:2466)
2025-09-16 18:09:19,432 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-09-05 00:00:00, 2025-09-11 00:00:00) for snapshot SnapshotId<"champions_league_data"."intermediate"."int_ucl_matches": 1559678094> (facade.py:622)
2025-09-16 18:09:19,432 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"champions_league_data"."intermediate"."int_ucl_matches": 1559678094> (interval.py:214)
2025-09-16 18:09:19,863 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 2682729909> (evaluator.py:701)
2025-09-16 18:09:19,866 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 2682729909> (evaluator.py:910)
2025-09-16 18:09:19,956 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-09-05 00:00:00, 2025-09-11 00:00:00) into champions_league_data.sqlmesh__facts.facts__fct_ucl_league_standings__244289869' (evaluator.py:940)
2025-09-16 18:09:19,956 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ DESCRIBE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__244289869" (base.py:2466)
2025-09-16 18:09:20,034 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:20,034 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:20,039 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'sqlmesh__facts') AND table_name IN ('facts__fct_ucl_league_standings__244289869') (base.py:2466)
2025-09-16 18:09:20,046 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:20,051 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT type FROM DUCKDB_DATABASES() WHERE database_name = 'champions_league_data' (base.py:2466)
2025-09-16 18:09:20,056 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE OR REPLACE TABLE "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__244289869" AS WITH "hometeam" AS (SELECT "int_ucl_matches"."match_id" AS "match_id", "int_ucl_matches"."match_status" AS "match_status", "int_ucl_matches"."matchday" AS "matchday", "int_ucl_matches"."season_current_matchday" AS "season_current_matchday", "int_ucl_matches"."hometeam_id" AS "team_id", "int_ucl_matches"."hometeam_tla" AS "team_tla", 'HOME_TEAM' AS "home_away", "int_ucl_matches"."score_fulltime_home" AS "score_fulltime", "int_ucl_matches"."score_halftime_home" AS "score_halftime", "int_ucl_matches"."score_winner" AS "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__3904863268" AS "int_ucl_matches" WHERE "int_ucl_matches"."stage" = 'LEAGUE_STAGE'), "awayteam" AS (SELECT "int_ucl_matches"."match_id" AS "match_id", "int_ucl_matches"."match_status" AS "match_status", "int_ucl_matches"."matchday" AS "matchday", "int_ucl_matches"."season_current_matchday" AS "season_current_matchday", "int_ucl_matches"."awayteam_id" AS "team_id", "int_ucl_matches"."awayteam_tla" AS "team_tla", 'AWAY_TEAM' AS "home_away", "int_ucl_matches"."score_fulltime_away" AS "score_fulltime", "int_ucl_matches"."score_halftime_away" AS "score_halftime", "int_ucl_matches"."score_winner" AS "score_winner" FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__3904863268" AS "int_ucl_matches" WHERE "int_ucl_matches"."stage" = 'LEAGUE_STAGE'), "unioned_data" AS (SELECT "hometeam"."match_id" AS "match_id", "hometeam"."match_status" AS "match_status", "hometeam"."matchday" AS "matchday", "hometeam"."season_current_matchday" AS "season_current_matchday", "hometeam"."team_id" AS "team_id", "hometeam"."team_tla" AS "team_tla", "hometeam"."home_away" AS "home_away", "hometeam"."score_fulltime" AS "score_fulltime", "hometeam"."score_halftime" AS "score_halftime", "hometeam"."score_winner" AS "score_winner" FROM "hometeam" AS "hometeam" UNION ALL SELECT "awayteam"."match_id" AS "match_id", "awayteam"."match_status" AS "match_status", "awayteam"."matchday" AS "matchday", "awayteam"."season_current_matchday" AS "season_current_matchday", "awayteam"."team_id" AS "team_id", "awayteam"."team_tla" AS "team_tla", "awayteam"."home_away" AS "home_away", "awayteam"."score_fulltime" AS "score_fulltime", "awayteam"."score_halftime" AS "score_halftime", "awayteam"."score_winner" AS "score_winner" FROM "awayteam" AS "awayteam"), "points" AS (SELECT "ud"."match_id" AS "match_id", "ud"."matchday" AS "matchday", "ud"."team_id" AS "team_id", "ud"."team_tla" AS "team_tla", "t"."team_name" AS "team_name", "ud"."home_away" AS "home_away", "ud"."score_fulltime" AS "score_fulltime", "ud"."score_winner" AS "score_winner", "ud"."match_status" AS "match_status", SUM(CAST("ud"."score_halftime" AS INT)) OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "halftime_goals_scored", SUM(CAST("ud"."score_fulltime" AS INT)) OVER (PARTITION BY "ud"."team_id" ORDER BY "ud"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_scored", CASE WHEN "ud"."home_away" = "ud"."score_winner" THEN 3 WHEN "ud"."score_winner" = 'DRAW' THEN 1 ELSE 0 END AS "points_earned" FROM "unioned_data" AS "ud" LEFT JOIN "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_teams__2148090398" AS "t" ON "t"."team_id" = "ud"."team_id"), "goals_conceded" AS (SELECT "p"."match_id" AS "match_id", "p"."matchday" AS "matchday", "p"."team_id" AS "team_id", "p"."team_tla" AS "team_tla", "p"."team_name" AS "team_name", "p"."home_away" AS "home_away", "p"."score_fulltime" AS "score_fulltime", "p"."score_winner" AS "score_winner", "p"."match_status" AS "match_status", "p"."halftime_goals_scored" AS "halftime_goals_scored", "p"."total_goals_scored" AS "total_goals_scored", "p"."points_earned" AS "points_earned", SUM(CAST("p"."points_earned" AS INT)) OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_points_earned", "pp"."score_fulltime" AS "goals_conceded", SUM(CAST("pp"."score_fulltime" AS INT)) OVER (PARTITION BY "p"."team_id" ORDER BY "p"."matchday" ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS "total_goals_conceded" FROM "points" AS "p" JOIN "points" AS "pp" ON "p"."match_id" = "pp"."match_id" AND "p"."team_id" <> "pp"."team_id") SELECT "goals_conceded"."matchday" AS "matchday", "goals_conceded"."match_status" AS "match_status", "goals_conceded"."team_tla" AS "team_tla", "goals_conceded"."team_name" AS "team_name", "goals_conceded"."total_points_earned" AS "total_points_earned", "goals_conceded"."total_goals_scored" AS "total_goals_scored", "goals_conceded"."total_goals_conceded" AS "total_goals_conceded", "goals_conceded"."total_goals_scored" - "goals_conceded"."total_goals_conceded" AS "goal_differential", MAX("goals_conceded"."matchday") OVER (ORDER BY "goals_conceded"."matchday" DESC) AS "max_matchday" FROM "goals_conceded" AS "goals_conceded" WHERE "goals_conceded"."match_status" = 'FINISHED' ORDER BY "matchday", "team_name" DESC, "total_goals_conceded" DESC, "total_points_earned" DESC, "team_tla" (base.py:2466)
2025-09-16 18:09:20,189 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-09-05 00:00:00, 2025-09-11 00:00:00) for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 2682729909> (facade.py:622)
2025-09-16 18:09:20,189 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"champions_league_data"."facts"."fct_ucl_league_standings": 2682729909> (interval.py:214)
2025-09-16 18:09:20,522 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:125)
2025-09-16 18:09:20,522 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:165)
2025-09-16 18:09:21,175 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:125)
2025-09-16 18:09:21,329 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:125)
2025-09-16 18:09:21,335 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.facts' (evaluator.py:1360)
2025-09-16 18:09:21,335 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."facts" (base.py:2466)
2025-09-16 18:09:21,378 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.snapshots' (evaluator.py:1360)
2025-09-16 18:09:21,379 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."snapshots" (base.py:2466)
2025-09-16 18:09:21,420 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'champions_league_data.intermediate' (evaluator.py:1360)
2025-09-16 18:09:21,420 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE SCHEMA IF NOT EXISTS "champions_league_data"."intermediate" (base.py:2466)
2025-09-16 18:09:21,463 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'champions_league_data.intermediate.int_ucl_matches' to point at table 'champions_league_data.sqlmesh__intermediate.intermediate__int_ucl_matches__3904863268' (evaluator.py:1732)
2025-09-16 18:09:21,464 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,465 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,466 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'intermediate') AND table_name IN ('int_ucl_matches') (base.py:2466)
2025-09-16 18:09:21,470 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE OR REPLACE VIEW "champions_league_data"."intermediate"."int_ucl_matches" AS SELECT * FROM "champions_league_data"."sqlmesh__intermediate"."intermediate__int_ucl_matches__3904863268" (base.py:2466)
2025-09-16 18:09:21,569 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'champions_league_data.facts.fct_ucl_league_standings' to point at table 'champions_league_data.sqlmesh__facts.facts__fct_ucl_league_standings__244289869' (evaluator.py:1732)
2025-09-16 18:09:21,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,570 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,571 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'facts') AND table_name IN ('fct_ucl_league_standings') (base.py:2466)
2025-09-16 18:09:21,574 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE OR REPLACE VIEW "champions_league_data"."facts"."fct_ucl_league_standings" AS SELECT * FROM "champions_league_data"."sqlmesh__facts"."facts__fct_ucl_league_standings__244289869" (base.py:2466)
2025-09-16 18:09:21,677 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'champions_league_data.snapshots.ucl_matches_snapshot' to point at table 'champions_league_data.sqlmesh__snapshots.snapshots__ucl_matches_snapshot__4000463587' (evaluator.py:1732)
2025-09-16 18:09:21,677 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT CURRENT_CATALOG() (base.py:2466)
2025-09-16 18:09:21,679 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ SELECT table_name AS name, table_schema AS schema, CASE table_type WHEN 'BASE TABLE' THEN 'table' WHEN 'VIEW' THEN 'view' WHEN 'LOCAL TEMPORARY' THEN 'table' END AS type FROM system.information_schema.tables WHERE (table_catalog = 'champions_league_data' AND table_schema = 'snapshots') AND table_name IN ('ucl_matches_snapshot') (base.py:2466)
2025-09-16 18:09:21,682 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 0a0a408edafb4beeb27e4a06d43ac5f2 */ CREATE OR REPLACE VIEW "champions_league_data"."snapshots"."ucl_matches_snapshot" AS SELECT * FROM "champions_league_data"."sqlmesh__snapshots"."snapshots__ucl_matches_snapshot__4000463587" (base.py:2466)
2025-09-16 18:09:21,767 - MainThread - sqlmesh.core.context - INFO - Plan application failed. (context.py:1735)
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 234, in sequential_apply_to_dag
    fn(node)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 172, in <lambda>
    lambda s_id: fn(snapshots_by_id[s_id]),
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 311, in <lambda>
    lambda s: self._promote_snapshot(
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 1184, in _promote_snapshot
    _evaluation_strategy(snapshot, adapter).promote(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 1743, in promote
    self.adapter.create_view(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/shared.py", line 312, in internal_wrapper
    return func(*list_args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 1309, in create_view
    self.execute(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 2443, in execute
    self._execute(sql, track_rows_processed, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/engine_adapter/base.py", line 2475, in _execute
    self.cursor.execute(sql, **kwargs)
duckdb.duckdb.CatalogException: Catalog Error: Table with name snapshots__ucl_matches_snapshot__4000463587 does not exist!
Did you mean "snapshots__ucl_matches_snapshot__116872300"?

LINE 1: ..._data"."snapshots"."ucl_matches_snapshot" AS SELECT * FROM "champions_league_data"."sqlmesh__snapshots"."snapshots__uc...
                                                                      ^

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/context.py", line 1727, in apply
    self._apply(plan, circuit_breaker)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/context.py", line 2519, in _apply
    self._scheduler.create_plan_evaluator(self).evaluate(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 107, in evaluate
    self._evaluate_stages(plan_stages, plan)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 127, in _evaluate_stages
    handler(stage, plan)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 352, in visit_virtual_layer_update_stage
    self._promote_snapshots(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/plan/evaluator.py", line 387, in _promote_snapshots
    self.snapshot_evaluator.promote(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/core/snapshot/evaluator.py", line 309, in promote
    concurrent_apply_to_snapshots(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 170, in concurrent_apply_to_snapshots
    return concurrent_apply_to_dag(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 205, in concurrent_apply_to_dag
    return sequential_apply_to_dag(dag, fn, raise_on_error)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/sqlmesh/utils/concurrency.py", line 240, in sequential_apply_to_dag
    raise error
sqlmesh.utils.concurrency.NodeExecutionFailedError: Execution failed for node SnapshotId<"champions_league_data"."snapshots"."ucl_matches_snapshot": 3467897273>
2025-09-16 18:09:21,775 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
